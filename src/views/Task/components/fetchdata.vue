<script lang="ts" setup>
import { ref } from "vue";
import { useUserInfoStoreHook } from "@/store/modules/user";
import { deffHttp } from "@/utils/axios";
import type { TaskParams, UserParams } from "../types/task";

const emit = defineEmits<{
	(e: "submitForm"): boolean;
}>();

const userInfoStore = useUserInfoStoreHook();

//获取数据信息-实际与后端通信的API
const getTaskInfo = (user: string, id: number) =>
	deffHttp.post<TaskParams, UserParams>(
		{
			url: "http://localhost:5000/api/getTaskInfo",
			data: { username: user, userid: id },
		},
		{ errorMessageMode: "modal", withToken: false },
	);

//拉取数据
const FetchData = async (task_data: TaskParams[]) => {
	const res = await getTaskInfo(
		userInfoStore.userInfo?.name,
		userInfoStore.userInfo?.userid,
	);
	console.log(res.data);
	res.data.forEach((element) => {
		task_data.push(element);
	});

	console.log(task_data);

	emit("submitForm");
};

defineExpose({ FetchData });
</script>

<template>
	<div />
</template>
